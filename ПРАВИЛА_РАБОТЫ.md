# Правила работы

## Критически важное правило

**НИКОГДА НЕ СПОРИТЬ С ПОЛЬЗОВАТЕЛЕМ**

- Если пользователь показывает скриншот или описывает визуальное расположение - ВЕРИТЬ ему
- Если пользователь указывает на проблему - СРАЗУ исправлять, а не доказывать обратное
- Если пользователь говорит, что что-то не так - ПРИНИМАТЬ это как факт и искать решение
- НЕ вычислять и НЕ спорить, когда пользователь уже показал визуальное доказательство

## Принцип работы

1. **СНАЧАЛА анализировать скриншот** - внимательно смотреть, что на нём видно
2. **ПОТОМ исправлять код** - только после анализа скриншота
3. **Никогда не спорить с тем, что видно на скриншоте**

## Критически важное правило - НЕ ТРОГАТЬ

**ФУНКЦИЯ `getHexNeighbors()` - НИ В КОЕМ СЛУЧАЕ НЕ ТРОГАТЬ!**

- Определение соседей для чётных и нечётных столбцов настроено правильно
- Эта функция работает корректно и даёт правильные результаты
- НЕ изменять направления соседей
- НЕ изменять логику определения чётности столбцов
- Если есть проблемы с путём солдат - исправлять алгоритм поиска пути, а НЕ определение соседей

## Правила работы с покрашенными ячейками базы

**ВАЖНО: База игрока 1 состоит из ДВУХ строк!**

1. **Предпоследняя строка (y === height - 2)** с чётными индексами x (x % 2 === 0)
2. **Последняя строка (y === height - 1)** с нечётными индексами x (x % 2 === 1)

**КРИТИЧЕСКИ ВАЖНО:**
- Если ячейка покрашена в `drawGrid()` или `drawBases()` - она ДОЛЖНА быть заблокирована в `isBlocked()`
- Логика покраски и логика блокировки ДОЛЖНЫ совпадать полностью
- НИКОГДА не убирать покраску - вместо этого исправлять логику проверки
- Если пользователь говорит, что ячейка покрашена, но не блокируется - искать несоответствие между `draw*` и `isBlocked`

## Причины долгого решения проблемы с покрашенными ячейками

**Список ошибок, которые НЕ ДОПУСКАТЬ:**

1. **Неполное понимание структуры базы**
   - ❌ ОШИБКА: Думал, что база игрока 1 только на одной строке (height - 1)
   - ✅ ПРАВИЛЬНО: База игрока 1 состоит из двух строк (height - 2 и height - 1)

2. **Попытка убрать покраску вместо исправления логики**
   - ❌ ОШИБКА: Пытался убрать покраску из `drawGrid()`, когда пользователь сказал, что это база
   - ✅ ПРАВИЛЬНО: Если ячейка покрашена - она должна быть заблокирована, а не убрана

3. **Несоответствие между визуализацией и логикой**
   - ❌ ОШИБКА: Покраска была в `drawGrid()` на строке height - 2, а проверка в `isBlocked()` только на height - 1
   - ✅ ПРАВИЛЬНО: Все места покраски должны совпадать с логикой `isBlocked()`

4. **Недостаточный поиск всех мест покраски**
   - ❌ ОШИБКА: Не сразу нашёл покраску в `drawGrid()` на строке height - 2
   - ✅ ПРАВИЛЬНО: Искать ВСЕ места, где происходит покраска (`grep` по цветам, `rgba`, `drawHex`)

5. **Игнорирование истории проблемы**
   - ❌ ОШИБКА: Пользователь сказал "мы очень долго решали эту проблему" - значит структура базы уже была определена ранее
   - ✅ ПРАВИЛЬНО: Если пользователь говорит о долгой истории решения - искать в коде комментарии и логику, которая уже была реализована

6. **Неиспользование инструментов отладки**
   - ❌ ОШИБКА: Не сразу использовал тест ячеек для проверки состояния
   - ✅ ПРАВИЛЬНО: Сразу создавать/использовать инструменты отладки, когда пользователь просит

**ПРАВИЛО:**
- Перед изменением логики блокировки - найти ВСЕ места покраски
- Убедиться, что логика `isBlocked()` покрывает ВСЕ покрашенные ячейки
- Если ячейка покрашена, но не блокируется - это ОШИБКА несоответствия, а не повод убирать покраску

